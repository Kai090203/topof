<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Coin Trader Pro - Detail</title>
    <style>
        /* --- ê¸°ë³¸ í…Œë§ˆ --- */
        body { 
            background-color: #f3f4f6; 
            color: #333; 
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            height: 100vh; 
            margin: 0; 
            overflow: hidden;
        }

        /* --- ë¡œê·¸ì¸ í™”ë©´ --- */
        #loginScreen {
            position: absolute;
            z-index: 999;
            background-color: rgba(255,255,255,0.95);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #ddd;
        }
        .login-input { padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; width: 200px; margin-bottom: 15px; }
        .btn-login { background-color: #2c3e50; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-login:hover { background-color: #34495e; }

        /* --- ë©”ì¸ UI --- */
        .news-bar {
            width: 100%;
            background-color: white;
            padding: 12px 0;
            text-align: center;
            position: absolute;
            top: 0;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .news-badge { background-color: #e74c3c; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-right: 10px; }
        #newsDisplay { font-size: 1.05em; font-weight: 600; color: #333; transition: opacity 0.3s; }
        .logout-btn { position: absolute; top: 12px; right: 20px; background: #eee; border: none; padding: 5px 12px; cursor: pointer; font-size: 12px; border-radius: 4px; color: #555; }

        .container { display: none; gap: 20px; margin-top: 60px; }
        .panel { background-color: white; border: 1px solid #e0e0e0; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .left-panel { display: flex; flex-direction: column; align-items: center; }
        
        /* ì˜¤ë¥¸ìª½ íŒ¨ë„ & íƒ­ */
        .right-panel-wrapper { width: 360px; height: 640px; display: flex; flex-direction: column; overflow: hidden; }
        .tab-group { display: flex; background-color: #e0e0e0; border-top-left-radius: 12px; border-top-right-radius: 12px; }
        .tab-btn { flex: 1; padding: 15px; border: none; background-color: #e0e0e0; cursor: pointer; font-weight: bold; color: #7f8c8d; font-size: 1em; }
        .tab-btn.active { background-color: white; color: #2c3e50; border-top: 3px solid #3498db; }
        .right-panel { flex: 1; overflow-y: auto; background-color: white; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .coin-item { padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: 0.1s; }
        .coin-item:hover { background-color: #f9f9f9; }
        .coin-item.active { background-color: #f0f7ff; border-left: 4px solid #3498db; }
        
        .row-basic { display: flex; justify-content: space-between; align-items: center; }
        .coin-name { font-weight: bold; font-size: 1.1em; color: #333; }
        .coin-price-mini { font-size: 0.9em; margin-top: 4px; }
        
        /* ìƒì„¸ ì •ë³´ ë°•ìŠ¤ (ë³´ìœ  íƒ­ ì „ìš©) */
        .holding-detail {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-size: 0.85em;
            display: flex;
            justify-content: space-between;
            color: #555;
        }
        .detail-col { display: flex; flex-direction: column; gap: 4px; }
        .lbl { color: #888; font-size: 0.9em; }
        .val { font-weight: bold; font-size: 1.1em; }

        /* ê³µí†µ ìœ í‹¸ */
        .red { color: #e74c3c; } 
        .blue { color: #3498db; } 
        .bold { font-weight: bold; }

        /* ì°¨íŠ¸ ë° ìì‚° íŒ¨ë„ */
        canvas { background-color: white; border: 1px solid #eee; border-radius: 8px; margin-bottom: 15px; }
        .header-info { text-align: center; margin-bottom: 15px; width: 100%; }
        .coin-title { font-size: 1.8em; font-weight: 800; margin: 0; color: #222; }
        .price-big { font-size: 2.2em; font-weight: bold; margin: 5px 0; }

        .asset-panel { width: 580px; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); }
        .trade-controls { width: 620px; padding: 20px; box-sizing: border-box; }
        .input-group { display: flex; gap: 10px; margin-bottom: 12px; }
        input[type="number"] { flex: 1; background-color: #fff; border: 1px solid #ccc; color: #333; padding: 12px; font-size: 1.2em; border-radius: 6px; text-align: right; outline: none; }
        .btn-max { background-color: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer; width: 80px; font-weight: bold; }
        .btn-group { display: flex; gap: 10px; }
        .action-btn { padding: 15px 0; font-size: 16px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; color: white; flex: 1; }
        .btn-buy { background-color: #e74c3c; }
        .btn-sell { background-color: #3498db; }
        #msgBox { color: #f39c12; text-align: center; height: 20px; margin-bottom: 8px; font-weight: bold; font-size: 0.9em; }

        .empty-state { text-align: center; color: #aaa; margin-top: 50px; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h2>Coin Trader Pro</h2>
        <p style="color:#666; margin-bottom:20px;">íˆ¬ìì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
        <input type="text" id="usernameInput" class="login-input" placeholder="ì´ë¦„" onkeydown="if(event.key==='Enter') login()">
        <br>
        <button class="btn-login" onclick="login()">ì ‘ì†í•˜ê¸°</button>
    </div>
</div>

<div class="news-bar">
    <span class="news-badge">LIVE</span>
    <div id="newsDisplay">ì‹œì¥ ë°ì´í„° ë¡œë”© ì¤‘...</div>
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div class="container" id="gameContainer">
    <div class="left-panel panel">
        <div style="padding: 20px; width: 580px;">
            <div class="header-info">
                <div class="coin-title" id="displayTitle">BTC ë¹„íŠ¸ì½”ì¸</div>
                <div class="price-big" id="displayPrice">0 ì›</div>
            </div>

            <canvas id="chartCanvas" width="580" height="280"></canvas>

            <div class="asset-panel panel">
                <div>
                    <div style="color:#7f8c8d; font-size:0.9em;">ë³´ìœ  í˜„ê¸ˆ</div>
                    <div style="font-size:1.5em; font-weight:bold; color:#2c3e50;" id="displayCash">0</div>
                </div>
                <div style="text-align: right;">
                    <div style="color:#7f8c8d; font-size:0.9em;">ë³´ìœ  ìˆ˜ëŸ‰ (<span id="holdingName">BTC</span>)</div>
                    <div style="font-size:1.5em; font-weight:bold; color:#2c3e50;" id="displayHolding">0</div>
                </div>
            </div>

            <div class="trade-controls panel">
                <div id="msgBox"></div> 
                <div class="input-group">
                    <input type="number" id="tradeQty" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" step="0.0001">
                    <button class="btn-max" onclick="setMaxQty()">ìµœëŒ€</button>
                </div>
                <div class="btn-group">
                    <button class="action-btn btn-buy" onclick="buyManual()">ë§¤ìˆ˜</button>
                    <button class="action-btn btn-sell" onclick="sellManual()">ë§¤ë„</button>
                </div>
                <div style="margin-top:15px; display:flex; justify-content:space-between; font-weight:bold; color:#555;">
                    <span id="totalAssetDisplay">ì´ ìì‚°: 0ì›</span>
                    <span id="profitDisplay">ìˆ˜ìµë¥ : 0%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="right-panel-wrapper panel">
        <div class="tab-group">
            <button class="tab-btn active" id="tabAll" onclick="setTab('all')">ğŸŒ ì „ì²´ ì‹œì„¸</button>
            <button class="tab-btn" id="tabMy" onclick="setTab('my')">ğŸ’¼ ë‚´ ë³´ìœ  ì½”ì¸</button>
        </div>
        <div class="right-panel" id="coinList"></div>
    </div>
</div>

<script>
    // --- ë°ì´í„° ë° ë³€ìˆ˜ ---
    const initialCoins = [
        { code: "BTC", name: "ë¹„íŠ¸ì½”ì¸", price: 100000000, volatility: 1.0 },
        { code: "ETH", name: "ì´ë”ë¦¬ì›€", price: 5000000, volatility: 1.2 },
        { code: "XRP", name: "ë¦¬í”Œ", price: 800, volatility: 1.5 },
        { code: "SOL", name: "ì†”ë¼ë‚˜", price: 200000, volatility: 1.4 },
        { code: "DOGE", name: "ë„ì§€ì½”ì¸", price: 200, volatility: 2.5 },
        { code: "ADA", name: "ì—ì´ë‹¤", price: 700, volatility: 1.3 },
        { code: "SHIB", name: "ì‹œë°”ì´ëˆ„", price: 0.05, volatility: 3.0 },
        { code: "TRX", name: "íŠ¸ë¡ ", price: 150, volatility: 1.1 },
        { code: "AVAX", name: "ì•„ë°œë€ì²´", price: 50000, volatility: 1.4 },
        { code: "DOT", name: "í´ì¹´ë‹·", price: 10000, volatility: 1.3 },
        { code: "MATIC", name: "í´ë¦¬ê³¤", price: 1200, volatility: 1.4 },
        { code: "LTC", name: "ë¼ì´íŠ¸ì½”ì¸", price: 100000, volatility: 1.1 },
        { code: "BCH", name: "ë¹„íŠ¸ìºì‹œ", price: 600000, volatility: 1.2 },
        { code: "UNI", name: "ìœ ë‹ˆìŠ¤ì™‘", price: 8000, volatility: 1.5 },
        { code: "LINK", name: "ì²´ì¸ë§í¬", price: 20000, volatility: 1.3 },
        { code: "ETC", name: "ì´í´", price: 30000, volatility: 1.4 },
        { code: "XLM", name: "ìŠ¤í…”ë¼", price: 180, volatility: 1.3 },
        { code: "ALGO", name: "ì•Œê³ ëœë“œ", price: 250, volatility: 1.4 },
        { code: "EOS", name: "ì´ì˜¤ìŠ¤", price: 1000, volatility: 1.2 },
        { code: "SAND", name: "ìƒŒë“œë°•ìŠ¤", price: 800, volatility: 1.8 }
    ];

    const newsTemplates = [
        { text: "{name} ETF ìŠ¹ì¸ ì„ë°•!", type: "good", power: 1.08 },
        { text: "ê¸°ê´€, {name} ëŒ€ëŸ‰ ë§¤ì§‘ í¬ì°©", type: "good", power: 1.06 },
        { text: "{name}, ê²°ì œ ì‹œìŠ¤í…œ ë„ì…ì„¤", type: "good", power: 1.05 },
        { text: "{name} í•´í‚¹ ë°œìƒ, ê°€ê²© ê¸‰ë½", type: "bad", power: 0.90 },
        { text: "ê·œì œ ë‹¹êµ­, {name} ì¡°ì‚¬ ì°©ìˆ˜", type: "bad", power: 0.88 },
        { text: "ì „ì²´ ì½”ì¸ ì‹œì¥ ì¡°ì • êµ­ë©´", type: "bad", power: 0.97 }
    ];

    let currentUser = null;
    let coins = [];
    let myCash = 10000000;
    
    // êµ¬ì¡° ë³€ê²½: { "BTC": { qty: 0, totalCost: 0 } }
    let myHoldings = {}; 
    
    let chartHistory = [];
    let selectedCoinIdx = 0;
    const maxHistory = 60;
    let currentTab = 'all';

    let canvas = document.getElementById("chartCanvas");
    let ctx = canvas.getContext("2d");
    let gameInterval;

    // --- ë¡œê·¸ì¸ ë° ë°ì´í„° ë¡œë“œ ---
    function login() {
        let username = document.getElementById("usernameInput").value.trim();
        if(!username) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        currentUser = username;
        
        let savedData = localStorage.getItem("btcGame_v4_" + currentUser);
        if(savedData) {
            let parsed = JSON.parse(savedData);
            myCash = parsed.myCash;
            coins = parsed.coins;
            chartHistory = parsed.chartHistory;
            
            // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (êµ¬ë²„ì „ -> ì‹ ë²„ì „)
            // ì˜ˆì „ì—ëŠ” myHoldingsê°€ {BTC: 0.5} ì˜€ë‹¤ë©´ ì§€ê¸ˆì€ {BTC: {qty:0.5, totalCost:?}}
            // savedDataë¥¼ ë¶ˆëŸ¬ì˜¨ ì§í›„ myHoldings êµ¬ì¡° í™•ì¸
            myHoldings = {};
            // ì½”ì¸ ëª©ë¡ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ë³µêµ¬
            parsed.coins.forEach(c => {
                let savedHolding = parsed.myHoldings[c.code];
                if(typeof savedHolding === 'number') {
                    // êµ¬ë²„ì „ ë°ì´í„°: í‰ë‹¨ê°€ ì¶”ì  ë¶ˆê°€í•˜ë¯€ë¡œ, í˜„ì¬ê°€ë¥¼ í‰ë‹¨ê°€ë¡œ ê°€ì •í•˜ê±°ë‚˜ 0ìœ¼ë¡œ ë‘ 
                    // ì—¬ê¸°ì„œëŠ” í¸ì˜ìƒ 0ì›ìœ¼ë¡œ ì´ˆê¸°í™” (ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í•„ìš”í•  ìˆ˜ ìˆìŒ)
                    myHoldings[c.code] = { qty: savedHolding, totalCost: savedHolding * c.price }; 
                } else if (typeof savedHolding === 'object') {
                    // ì‹ ë²„ì „ ë°ì´í„°
                    myHoldings[c.code] = savedHolding;
                } else {
                    myHoldings[c.code] = { qty: 0, totalCost: 0 };
                }
            });

            if(!chartHistory || chartHistory.length !== coins.length) initNewGameData();

        } else {
            initNewGameData();
        }

        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("gameContainer").style.display = "flex";
        
        setTab('all');
        updateDisplay();
        gameInterval = setInterval(gameLoop, 1000);
    }

    function initNewGameData() {
        myCash = 10000000;
        myHoldings = {};
        coins = JSON.parse(JSON.stringify(initialCoins));
        chartHistory = [];
        coins.forEach((c, i) => {
            myHoldings[c.code] = { qty: 0, totalCost: 0 };
            chartHistory[i] = new Array(maxHistory).fill(c.price);
        });
    }

    function saveData() {
        if(!currentUser) return;
        let data = { myCash, myHoldings, coins, chartHistory };
        localStorage.setItem("btcGame_v4_" + currentUser, JSON.stringify(data));
    }

    function logout() {
        clearInterval(gameInterval);
        saveData();
        location.reload();
    }

    // --- íƒ­ ê¸°ëŠ¥ ---
    function setTab(mode) {
        currentTab = mode;
        document.getElementById("tabAll").className = mode === 'all' ? "tab-btn active" : "tab-btn";
        document.getElementById("tabMy").className = mode === 'my' ? "tab-btn active" : "tab-btn";
        renderCoinList();
    }

    // --- ë©”ì¸ ë£¨í”„ ---
    function gameLoop() {
        if(Math.random() < 0.1) {
            let t = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
            let tIdx = Math.floor(Math.random() * coins.length);
            let target = coins[tIdx];
            showNews(t.text.replace("{name}", target.name), t.type === "good" ? "#e74c3c" : "#3498db");
            coins[tIdx].price *= t.power;
        }

        coins.forEach((c, i) => {
            let fluc = (Math.random() * 0.04 - 0.02) * c.volatility;
            c.price *= (1 + fluc);
            if(c.price < 0.01) c.price = 0.01;
            chartHistory[i].push(c.price);
            if(chartHistory[i].length > maxHistory) chartHistory[i].shift();
        });

        renderCoinList();
        updateDisplay();
        drawChart();
        saveData();
    }

    // --- ë§¤ë§¤ ë¡œì§ (í‰ë‹¨ê°€ ê³„ì‚° í•µì‹¬) ---
    function setMaxQty() {
        let coin = coins[selectedCoinIdx];
        document.getElementById("tradeQty").value = Math.floor((myCash / coin.price) * 10000) / 10000;
    }

    function buyManual() {
        let qty = parseFloat(document.getElementById("tradeQty").value);
        let coin = coins[selectedCoinIdx];
        if(!qty || qty <= 0) return showMessage("ìˆ˜ëŸ‰ ì˜¤ë¥˜");

        let cost = qty * coin.price;
        if(myCash >= cost) {
            myCash -= cost;
            
            // í‰ë‹¨ê°€ ê³„ì‚°: ì´ ë§¤ìˆ˜ê¸ˆì•¡ ëˆ„ì 
            myHoldings[coin.code].qty += qty;
            myHoldings[coin.code].totalCost += cost;

            showMessage("ë§¤ìˆ˜ ì²´ê²° ì™„ë£Œ");
            updateDisplay();
            renderCoinList(); 
            saveData();
        } else showMessage("ì”ì•¡ ë¶€ì¡±");
    }

    function sellManual() {
        let qty = parseFloat(document.getElementById("tradeQty").value);
        let coin = coins[selectedCoinIdx];
        if(!qty || qty <= 0) return showMessage("ìˆ˜ëŸ‰ ì˜¤ë¥˜");
        
        let holding = myHoldings[coin.code];
        if(holding.qty >= qty) {
            // ë§¤ë„ ì‹œ í‰ë‹¨ê°€ëŠ” ë³€í•˜ì§€ ì•ŠìŒ -> totalCostë¥¼ ë¹„ìœ¨ë§Œí¼ ì°¨ê°
            // ì˜ˆ: 10ê°œ ë³´ìœ (ì´100ì›), 5ê°œ ë§¤ë„ -> ë‚¨ì€ 5ê°œì˜ ê°€ì¹˜ëŠ” 50ì›ì´ ë˜ì–´ì•¼ í•¨ (í‰ë‹¨ ìœ ì§€)
            let sellRatio = qty / holding.qty;
            holding.totalCost -= (holding.totalCost * sellRatio);
            
            holding.qty -= qty;
            myCash += qty * coin.price;

            if(holding.qty < 0.000001) {
                holding.qty = 0;
                holding.totalCost = 0;
            }

            showMessage("ë§¤ë„ ì²´ê²° ì™„ë£Œ");
            updateDisplay();
            renderCoinList();
            saveData();
        } else showMessage("ë³´ìœ  ë¶€ì¡±");
    }

    function showMessage(msg) {
        let el = document.getElementById("msgBox");
        el.innerText = msg;
        setTimeout(() => el.innerText = "", 2000);
    }

    // --- ë Œë”ë§ ---
    function renderCoinList() {
        let listEl = document.getElementById("coinList");
        listEl.innerHTML = "";

        // í•„í„°ë§
        let displayCoins = [];
        if(currentTab === 'all') {
            displayCoins = coins.map((c, i) => ({...c, originalIdx: i}));
        } else {
            coins.forEach((c, i) => {
                if(myHoldings[c.code].qty > 0) displayCoins.push({...c, originalIdx: i});
            });
        }

        if(displayCoins.length === 0 && currentTab === 'my') {
            listEl.innerHTML = "<div class='empty-state'>ë³´ìœ  ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.<br>ë§¤ìˆ˜ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</div>";
            return;
        }

        displayCoins.forEach(coin => {
            let idx = coin.originalIdx;
            let div = document.createElement("div");
            let holding = myHoldings[coin.code];
            let isHolding = holding.qty > 0;
            
            div.className = "coin-item" + (idx === selectedCoinIdx ? " active" : "");
            div.onclick = () => selectCoin(idx);

            // ê¸°ë³¸ ì‹œì„¸ ì •ë³´
            let prev = chartHistory[idx][chartHistory[idx].length - 2] || coin.price;
            let colorClass = coin.price >= prev ? "red" : "blue";
            let sign = coin.price >= prev ? "+" : "";
            let pct = ((coin.price - prev) / prev * 100).toFixed(2);
            
            // ë¦¬ìŠ¤íŠ¸ ë‚´ìš© êµ¬ì„±
            let html = `
                <div class="row-basic">
                    <div>
                        <div class="coin-name">${coin.name}</div>
                        <div class="coin-price-mini ${colorClass}">${sign}${pct}%</div>
                    </div>
                    <div style="text-align:right;">
                        <div class="${colorClass} bold">${formatPrice(coin.price)}</div>
                    </div>
                </div>
            `;

            // [ë³´ìœ  íƒ­]ì¼ ê²½ìš° ìƒì„¸ ì •ë³´ ì¶”ê°€
            if(currentTab === 'my') {
                let currentVal = holding.qty * coin.price;
                let profit = currentVal - holding.totalCost;
                let roi = 0;
                if(holding.totalCost > 0) roi = (profit / holding.totalCost) * 100;
                
                let roiColor = profit >= 0 ? "red" : "blue";
                let roiSign = profit >= 0 ? "+" : "";
                
                let avgPrice = holding.totalCost / holding.qty;

                html += `
                    <div class="holding-detail">
                        <div class="detail-col">
                            <span class="lbl">ë³´ìœ ìˆ˜ëŸ‰</span>
                            <span class="val" style="color:#333">${holding.qty.toFixed(4)}</span>
                        </div>
                        <div class="detail-col" style="text-align:right;">
                            <span class="lbl">í‰ë‹¨ê°€</span>
                            <span class="val" style="color:#555">${formatPrice(avgPrice)}</span>
                        </div>
                    </div>
                    <div class="holding-detail" style="margin-top:5px; background-color: #fff;">
                        <div class="detail-col">
                            <span class="lbl">í‰ê°€ì†ìµ</span>
                            <span class="val ${roiColor}">${roiSign}${Math.floor(profit).toLocaleString()}</span>
                        </div>
                        <div class="detail-col" style="text-align:right;">
                            <span class="lbl">ìˆ˜ìµë¥ </span>
                            <span class="val ${roiColor}">${roiSign}${roi.toFixed(2)}%</span>
                        </div>
                    </div>
                `;
            } else {
                // [ì „ì²´ íƒ­]ì—ì„œë„ ë³´ìœ ì¤‘ì´ë©´ í‘œì‹œ
                if(isHolding) {
                    html += `<div style="font-size:0.8em; color:#f39c12; font-weight:bold; text-align:right; margin-top:2px;">ë³´ìœ ì¤‘</div>`;
                }
            }

            div.innerHTML = html;
            listEl.appendChild(div);
        });
    }

    function selectCoin(idx) {
        selectedCoinIdx = idx;
        document.getElementById("tradeQty").value = "";
        renderCoinList(); 
        updateDisplay();
        drawChart();
    }

    function updateDisplay() {
        let cur = coins[selectedCoinIdx];
        document.getElementById("displayTitle").innerText = `${cur.code} ${cur.name}`;
        
        let prev = chartHistory[selectedCoinIdx][chartHistory[selectedCoinIdx].length-2];
        let pEl = document.getElementById("displayPrice");
        pEl.innerText = formatPrice(cur.price);
        pEl.className = "price-big " + (cur.price >= prev ? "red" : "blue");

        document.getElementById("displayCash").innerText = Math.floor(myCash).toLocaleString();
        document.getElementById("holdingName").innerText = cur.code;
        
        let holding = myHoldings[cur.code];
        document.getElementById("displayHolding").innerText = holding.qty > 0 ? holding.qty.toFixed(4) : "0";

        let totalVal = myCash;
        coins.forEach(c => totalVal += c.price * myHoldings[c.code].qty);
        document.getElementById("totalAssetDisplay").innerText = "ì´ ìì‚°: " + Math.floor(totalVal).toLocaleString() + " ì›";
        
        let rate = ((totalVal - 10000000)/10000000)*100;
        let rEl = document.getElementById("profitDisplay");
        rEl.innerText = `ì´ ìˆ˜ìµ: ${rate.toFixed(2)} %`;
        rEl.style.color = rate >= 0 ? "#e74c3c" : "#3498db";
    }

    function drawChart() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = "#eee"; ctx.lineWidth=1; ctx.beginPath();
        for(let j=1;j<5;j++){ let h=(canvas.height/5)*j; ctx.moveTo(0,h); ctx.lineTo(canvas.width,h); }
        ctx.stroke();

        let d = chartHistory[selectedCoinIdx];
        if(d.length<2) return;
        let min=Math.min(...d), max=Math.max(...d), r=max-min || 1;
        
        ctx.beginPath();
        for(let i=0; i<d.length; i++){
            let x=(i/(maxHistory-1))*canvas.width;
            let y=canvas.height - ((d[i]-min)/r)*(canvas.height-60)-30;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        let up = d[d.length-1]>=d[0];
        ctx.strokeStyle = up ? "#e74c3c" : "#3498db";
        ctx.lineWidth=2.5; ctx.lineJoin="round"; ctx.stroke();
    }

    function showNews(txt, col) {
        let el = document.getElementById("newsDisplay");
        el.style.opacity=0;
        setTimeout(()=>{
            el.innerHTML = `<span style='color:${col}'>â—</span> ` + txt;
            el.style.opacity=1;
        }, 300);
    }
    function formatPrice(p) { return p<100 ? p.toFixed(2)+" ì›" : Math.floor(p).toLocaleString()+" ì›"; }

</script>
</body>
</html>